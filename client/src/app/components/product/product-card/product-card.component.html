<div class="card" (click)="onCardClick($event)">
  @if (!!product.discount) {
  <div class="discount">-{{ product.discount * 100 }}%</div>
  }
  <div class="card-bar">
    <span class="card__vendor">{{
      isOwnProduct() ? "You" : product.vendor.userName
    }}</span>
    @if (isOwnProduct()) {
    <div
      class="vendor-actions"
      #menu
      role="button"
      (click)="optionsOpen.set(true)"
      (onClickOutside)="optionsOpen.set(false)"
    >
      <i-feather name="more-vertical" class="trigger"></i-feather>
      @if (optionsOpen()) {
      <ul class="actions">
        <li class="switch" (click)="toggleVisibility()">
          <pb-switch [value]="product.isVisible">
            <span class="label-menu">
              {{ product.isVisible ? "Visible" : "Hidden" }}
            </span>
          </pb-switch>
        </li>
        <div class="div"></div>
        <li (click)="editModalOpen.set(true)">
          <i-feather name="edit-3"></i-feather> Edit
        </li>
        <li class="delete" (click)="deleteModalOpen.set(true)">
          <i-feather name="trash"></i-feather>Delete
        </li>
      </ul>
      }
    </div>
    }
  </div>
  <h5 class="card__heading">{{ product.name }}</h5>
  <div class="chips">
    @if (isOwnProduct()) {

    <div
      #visibility
      [class]="{ visibility: true, hidden: !product.isVisible }"
      (click)="toggleVisibility()"
    >
      <i-feather
        [name]="product.isVisible ? 'eye' : 'eye-off'"
        class="visibility-icon"
      ></i-feather>
      <span class="visibility-text">{{
        product.isVisible ? "Visible" : "Hidden"
      }}</span>
    </div>
    }
    <div class="category-chip">
      <div class="category-chip-bg"></div>
      <span class="category-chip-text">
        {{ product.category.displayValue }}</span
      >
    </div>
  </div>
  <div class="card-bar">
    <div class="card__price">
      {{ formattedPrice }}€ @if (!!product.discount) {
      <span class="card__price--old">{{ product.price.toFixed(2) }}€</span>
      }
    </div>
    @if (product.isVisible) {
    <div class="card__cta" role="button" (click)="onClickCTA()" #cta>
      <i-feather name="shopping-bag"></i-feather>
    </div>
    }
  </div>
</div>

@if (deleteModalOpen()) {
<pb-modal (close)="deleteModalOpen.set(false)">
  <pb-delete-confirm
    [product]="product"
    (delete)="onDeleteSuccess()"
  ></pb-delete-confirm>
</pb-modal>
} @if (editModalOpen()) {
<pb-modal (close)="editModalOpen.set(false)" [heading]="'Edit ' + product.name">
  <pb-add-product
    [initialValues]="product"
    (cancel)="editModalOpen.set(false)"
    (create)="onProductUpdated()"
  ></pb-add-product>
</pb-modal>
}
